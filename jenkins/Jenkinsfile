// Copyright (c) Microsoft. All rights reserved.
// Licensed under the MIT license. See LICENSE file in the project root for full license information.

def repoUrl = 'https://github.com/damonbarry/azure-iot-sdks-1.git'
def repoName =  'origin'
def branchName = 'develop'

node {
    echo SOURCE_BRANCH
    echo DESTINATION_BRANCH
    echo REPO_URI

    stage 'Checkout'
    checkout([
        $class: 'GitSCM',
        branches: [[name: "${repoName}/${branchName}"]],
        doGenerateSubmoduleConfigurations: false,
        extensions: [
            [$class: 'WipeWorkspace'],
            [$class: 'PruneStaleBranch'],
            [$class: 'SubmoduleOption', disableSubmodules: false, recursiveSubmodules: true, reference: '', trackingSubmodules: false]
        ],
        submoduleCfg: [],
        userRemoteConfigs: [[name: repoName, url: repoUrl]]
    ])

    stage 'Build Java'
    withCredentials([
        [$class: 'StringBinding', credentialsId: '05294bb0-93c3-4f01-a258-666586a3917c', variable: 'IOTHUB_CONNECTION_STRING'],
        [$class: 'StringBinding', credentialsId: '4a97c867-c403-4c77-839b-5eabf39feafe', variable: 'STORAGE_ACCOUNT_CONNECTION_STRING']])
    {
        sh 'jenkins/linux_java.sh'
    }
}
